package ru.eda.plgn.bizgen.generators.impl

import ru.eda.plgn.bizgen.generators.Generator
import ru.eda.plgn.bizgen.generators.GeneratorResult
import ru.eda.plgn.bizgen.generators.GeneratorResultWithEscape
import ru.eda.plgn.bizgen.generators.impl.OktmoGenerator.randomOktmo11
import ru.eda.plgn.bizgen.generators.impl.OktmoGenerator.randomOktmo8
import kotlin.random.Random

/**
 * Общероссийский классификатор территорий муниципальных образований (ОКТМО).
 *
 * ОКТМО будет состоять из 8 цифр.
 *
 * Код ОКТМО состоит из 8 или 11 цифр, в зависимости от уровня классификации:
 * - *Первые 2 цифры – субъект РФ (республика, край, область, город федерального значения).*
 * - *Следующие 3 цифры (3–5 позиции) – район, город областного подчинения.*
 * - *Последние 3 цифры (6–8 позиции) – город, посёлок, сельсовет и т. д.*
 * - *Дополнительные 3 цифры (9–11 позиции, если есть) – населённый пункт, микрорайон.*
 *
 * **See Also:**
 * [Общероссийский классификатор территорий муниципальных образований (сокр. ОКТМО)](https://ru.wikipedia.org/wiki/%D0%9E%D0%B1%D1%89%D0%B5%D1%80%D0%BE%D1%81%D1%81%D0%B8%D0%B9%D1%81%D0%BA%D0%B8%D0%B9_%D0%BA%D0%BB%D0%B0%D1%81%D1%81%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%82%D0%BE%D1%80_%D1%82%D0%B5%D1%80%D1%80%D0%B8%D1%82%D0%BE%D1%80%D0%B8%D0%B9_%D0%BC%D1%83%D0%BD%D0%B8%D1%86%D0%B8%D0%BF%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D1%85_%D0%BE%D0%B1%D1%80%D0%B0%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B9)
 *
 * @author Dmitry_Emelyanenko
 */
class Oktmo8Generator : Generator<String> {
  override fun generate(): GeneratorResult<String> = GeneratorResultWithEscape(data = randomOktmo8())
}

/**
 * Общероссийский классификатор территорий муниципальных образований (ОКТМО).
 *
 * ОКТМО будет состоять из 11 цифр.
 *
 * Код ОКТМО состоит из 8 или 11 цифр, в зависимости от уровня классификации:
 * - *Первые 2 цифры – субъект РФ (республика, край, область, город федерального значения).*
 * - *Следующие 3 цифры (3–5 позиции) – район, город областного подчинения.*
 * - *Последние 3 цифры (6–8 позиции) – город, посёлок, сельсовет и т. д.*
 * - *Дополнительные 3 цифры (9–11 позиции, если есть) – населённый пункт, микрорайон.*
 *
 * **See Also:**
 * [Общероссийский классификатор территорий муниципальных образований (сокр. ОКТМО)](https://ru.wikipedia.org/wiki/%D0%9E%D0%B1%D1%89%D0%B5%D1%80%D0%BE%D1%81%D1%81%D0%B8%D0%B9%D1%81%D0%BA%D0%B8%D0%B9_%D0%BA%D0%BB%D0%B0%D1%81%D1%81%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%82%D0%BE%D1%80_%D1%82%D0%B5%D1%80%D1%80%D0%B8%D1%82%D0%BE%D1%80%D0%B8%D0%B9_%D0%BC%D1%83%D0%BD%D0%B8%D1%86%D0%B8%D0%BF%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D1%85_%D0%BE%D0%B1%D1%80%D0%B0%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B9)
 *
 * @author Dmitry_Emelyanenko
 */
class Oktmo11Generator : Generator<String> {
  override fun generate(): GeneratorResult<String> = GeneratorResultWithEscape(data = randomOktmo11())
}

/**
 * Общероссийский классификатор территорий муниципальных образований (ОКТМО).
 *
 * Код ОКТМО состоит из 8 или 11 цифр, в зависимости от уровня классификации:
 * - *Первые 2 цифры – субъект РФ (республика, край, область, город федерального значения).*
 * - *Следующие 3 цифры (3–5 позиции) – район, город областного подчинения.*
 * - *Последние 3 цифры (6–8 позиции) – город, посёлок, сельсовет и т. д.*
 * - *Дополнительные 3 цифры (9–11 позиции, если есть) – населённый пункт, микрорайон.*
 *
 * **See Also:**
 * [Общероссийский классификатор территорий муниципальных образований (сокр. ОКТМО)](https://ru.wikipedia.org/wiki/%D0%9E%D0%B1%D1%89%D0%B5%D1%80%D0%BE%D1%81%D1%81%D0%B8%D0%B9%D1%81%D0%BA%D0%B8%D0%B9_%D0%BA%D0%BB%D0%B0%D1%81%D1%81%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%82%D0%BE%D1%80_%D1%82%D0%B5%D1%80%D1%80%D0%B8%D1%82%D0%BE%D1%80%D0%B8%D0%B9_%D0%BC%D1%83%D0%BD%D0%B8%D1%86%D0%B8%D0%BF%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D1%85_%D0%BE%D0%B1%D1%80%D0%B0%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B9)
 *
 * @author Dmitry_Emelyanenko
 */
private object OktmoGenerator {

  fun randomOktmo8(): String = findOKTMO(null, false) ?: ""

  fun randomOktmo11(): String = findOKTMO(null, true) ?: ""

  // База данных ОКТМО: 50 городов с 8-значными кодами и 50 - с 11-значными
  private val OKTMO_8_DATABASE = mapOf(
    "Москва" to "45300000",
    "Санкт-Петербург" to "40300000",
    "Новосибирск" to "50401000",
    "Екатеринбург" to "65401000",
    "Казань" to "92401000",
    "Нижний Новгород" to "22401000",
    "Челябинск" to "75401000",
    "Самара" to "36401000",
    "Омск" to "52401000",
    "Ростов-на-Дону" to "60401000",
    "Уфа" to "80401000",
    "Красноярск" to "04401000",
    "Пермь" to "57401000",
    "Воронеж" to "20401000",
    "Волгоград" to "18401000",
    "Краснодар" to "03401000",
    "Саратов" to "63401000",
    "Тюмень" to "71401000",
    "Тольятти" to "36405000",
    "Ижевск" to "94401000",
    "Барнаул" to "01401000",
    "Ульяновск" to "73401000",
    "Иркутск" to "25401000",
    "Хабаровск" to "08401000",
    "Ярославль" to "78401000",
    "Владивосток" to "05401000",
    "Махачкала" to "82401000",
    "Томск" to "69401000",
    "Оренбург" to "53401000",
    "Кемерово" to "32401000",
    "Новокузнецк" to "32404000",
    "Рязань" to "61401000",
    "Астрахань" to "12401000",
    "Набережные Челны" to "92403000",
    "Пенза" to "56401000",
    "Липецк" to "42401000",
    "Киров" to "33401000",
    "Чебоксары" to "97401000",
    "Тула" to "70401000",
    "Калининград" to "27401000",
    "Балашиха" to "45404000",
    "Курск" to "38401000",
    "Ставрополь" to "07401000",
    "Улан-Удэ" to "81401000",
    "Сочи" to "03426000",
    "Магнитогорск" to "75438000",
    "Тверь" to "28401000",
    "Севастополь" to "67300000",
    "Иваново" to "24401000",
    "Брянск" to "15401000",

    // --- дальнейшие 100+ городов, реалистичные, но не обязательно актуальные ---

    "Кострома" to "44401000",
    "Белгород" to "14401000",
    "Смоленск" to "66401000",
    "Орёл" to "57402000",
    "Мурманск" to "47401000",
    "Архангельск" to "29401000",
    "Псков" to "58401000",
    "Вологда" to "35401000",
    "Череповец" to "35402000",
    "Калуга" to "40401000",
    "Обнинск" to "40402000",
    "Тамбов" to "68401000",
    "Муром" to "33402000",
    "Ковров" to "33403000",
    "Подольск" to "46401000",
    "Королёв" to "46402000",
    "Мытищи" to "46403000",
    "Химки" to "46404000",
    "Красногорск" to "46405000",
    "Жуковский" to "46406000",
    "Сергиев Посад" to "46407000",
    "Коломна" to "46408000",
    "Елец" to "42402000",
    "Домодедово" to "46409000",
    "Орехово-Зуево" to "46410000",
    "Березники" to "57402000",
    "Соликамск" to "57403000",
    "Нижнекамск" to "92404000",
    "Альметьевск" to "92405000",
    "Зеленодольск" to "92406000",
    "Сургут" to "70801000",
    "Нижневартовск" to "70802000",
    "Ноябрьск" to "70803000",
    "Надым" to "70804000",
    "Салехард" to "70805000",
    "Ханты-Мансийск" to "70806000",
    "Тобольск" to "71402000",
    "Ишим" to "71403000",
    "Каменск-Уральский" to "65402000",
    "Новоуральск" to "65403000",
    "Первоуральск" to "65404000",
    "Алапаевск" to "65405000",
    "Невьянск" to "65406000",
    "Каменск-Шахтинский" to "60402000",
    "Таганрог" to "60403000",
    "Батайск" to "60404000",
    "Новочеркасск" to "60405000",
    "Шахты" to "60406000",
    "Владикавказ" to "90401000",
    "Грозный" to "20402000",
    "Нальчик" to "83401000",
    "Черкесск" to "91401000",
    "Майкоп" to "79401000",
    "Йошкар-Ола" to "86401000",
    "Саранск" to "88401000",
    "Петрозаводск" to "86402000",
    "Сыктывкар" to "86403000",
    "Курган" to "65407000",
    "Петропавловск-Камчатский" to "04402000",
    "Южно-Сахалинск" to "65409000",
    "Комсомольск-на-Амуре" to "08402000",
    "Благовещенск" to "10401000",
    "Анжеро-Судженск" to "32405000",
    "Прокопьевск" to "32406000",
    "Бийск" to "01402000",
    "Рубцовск" to "01403000",
    "Кисловодск" to "07402000",
    "Ессентуки" to "07403000",
    "Пятигорск" to "07404000",
    "Минеральные Воды" to "07405000",
    "Геленджик" to "03402000",
    "Анапа" to "03403000",
    "Армавир" to "03404000",
    "Новошахтинск" to "60407000",
    "Азов" to "60408000",
    "Ленинск-Кузнецкий" to "32407000",
    "Копейск" to "75402000",
    "Златоуст" to "75403000",
    "Миасс" to "75404000",
    "Глазов" to "94402000",
    "Воткинск" to "94403000",
    "Салават" to "80402000",
    "Стерлитамак" to "80403000",
    "Нефтекамск" to "80404000",
    "Бердск" to "50402000",
    "Куйбышев" to "50403000",
    "Рубцовск" to "01404000",
    "Темрюк" to "03405000"
  )

  private val OKTMO_11_DATABASE = mapOf(
    // Крупные города (1-50)
    "Москва" to "45000000000",
    "Санкт-Петербург" to "40000000000",
    "Новосибирск" to "50000000000",
    "Екатеринбург" to "65000000000",
    "Казань" to "92000000000",
    "Нижний_Новгород" to "22000000000",
    "Челябинск" to "75000000000",
    "Самара" to "36000000000",
    "Омск" to "52000000000",
    "Ростов_на_Дону" to "60000000000",
    "Уфа" to "80000000000",
    "Красноярск" to "04000000000",
    "Пермь" to "57000000000",
    "Воронеж" to "20000000000",
    "Волгоград" to "18000000000",
    "Краснодар" to "03000000000",
    "Саратов" to "63000000000",
    "Тюмень" to "71000000000",
    "Тольятти" to "36004000000",
    "Ижевск" to "94000000000",
    "Барнаул" to "01000000000",
    "Ульяновск" to "73000000000",
    "Иркутск" to "25000000000",
    "Хабаровск" to "08000000000",
    "Ярославль" to "78000000000",
    "Владивосток" to "05000000000",
    "Махачкала" to "82000000000",
    "Томск" to "69000000000",
    "Оренбург" to "53000000000",
    "Кемерово" to "32000000000",
    "Новокузнецк" to "32000000000",
    "Рязань" to "61000000000",
    "Астрахань" to "12000000000",
    "Пенза" to "56000000000",
    "Липецк" to "42000000000",
    "Тула" to "70000000000",
    "Киров" to "33000000000",
    "Чебоксары" to "97000000000",
    "Калининград" to "27000000000",
    "Брянск" to "15000000000",
    "Курск" to "38000000000",
    "Иваново" to "24000000000",
    "Магнитогорск" to "75000000000",
    "Тверь" to "28000000000",
    "Ставрополь" to "07000000000",
    "Белгород" to "14000000000",
    "Сочи" to "03000000000",
    "Волжский" to "18000000000",
    "Сургут" to "71000000000",
    "Чита" to "76000000000",

    // Московская область (51-100)
    "Балашиха" to "46004000000",
    "Химки" to "46008000000",
    "Подольск" to "46016000000",
    "Королев" to "46034000000",
    "Мытищи" to "46046000000",
    "Люберцы" to "46048000000",
    "Коломна" to "46038000000",
    "Электросталь" to "46040000000",
    "Одинцово" to "46055000000",
    "Жуковский" to "46025000000",
    "Серпухов" to "46070000000",
    "Щелково" to "46059000000",
    "Домодедово" to "46009000000",
    "Пушкино" to "46058000000",
    "Ногинск" to "46051000000",
    "Долгопрудный" to "46016000000",
    "Реутов" to "46016000000",
    "Видное" to "46010000000",
    "Дубна" to "46018000000",
    "Егорьевск" to "46022000000",
    "Сергиев_Посад" to "46028000000",
    "Воскресенск" to "46010000000",
    "Клин" to "46037000000",
    "Чехов" to "46057000000",
    "Наро-Фоминск" to "46038000000",
    "Лобня" to "46040000000",
    "Солнечногорск" to "46052000000",
    "Истра" to "46033000000",
    "Дмитров" to "46015000000",
    "Кашира" to "46035000000",
    "Можайск" to "46033000000",
    "Талдом" to "46046000000",
    "Павловский_Посад" to "46046000000",
    "Луховицы" to "46030000000",
    "Шатура" to "46057000000",
    "Озеры" to "46056000000",
    "Зарайск" to "46016000000",
    "Краснознаменск" to "46046000000",
    "Молодежный" to "46046000000",
    "Власиха" to "46046000000",
    "Звездный_городок" to "46046000000",
    "Кубинка" to "46023000000",
    "Голицыно" to "46025000000",
    "Красково" to "46029000000",
    "Томилино" to "46046000000",
    "Малаховка" to "46046000000",
    "Быково" to "46046000000",
    "Удельная" to "46046000000",
    "Правдинский" to "46046000000",
    "Заречье" to "46046000000",

    // Ленинградская область (101-150)
    "Гатчина" to "41000000000",
    "Выборг" to "41000000000",
    "Тосно" to "41000000000",
    "Кириши" to "41000000000",
    "Кингисепп" to "41000000000",
    "Всеволожск" to "41000000000",
    "Сосновый_Бор" to "41000000000",
    "Тихвин" to "41000000000",
    "Сертолово" to "41000000000",
    "Кировск" to "41000000000",
    "Луга" to "41000000000",
    "Сланцы" to "41000000000",
    "Приозерск" to "41000000000",
    "Подпорожье" to "41000000000",
    "Волхов" to "41000000000",
    "Лодейное_Поле" to "41000000000",
    "Пикалево" to "41000000000",
    "Коммунар" to "41000000000",
    "Никольское" to "41000000000",
    "Отрадное" to "41000000000",
    "Бокситогорск" to "41000000000",
    "Сясьстрой" to "41000000000",
    "Шлиссельбург" to "41000000000",
    "Сиверский" to "41000000000",
    "Вырица" to "41000000000",
    "Рощино" to "41000000000",
    "Горбунки" to "41000000000",
    "Лебяжье" to "41000000000",
    "Мга" to "41000000000",
    "Новый_Участок" to "41000000000",
    "Тельмана" to "41000000000",
    "Дубровка" to "41000000000",
    "Назия" to "41000000000",
    "Павлово" to "41000000000",
    "Приладожский" to "41000000000",
    "Рахьи" to "41000000000",
    "Санкт-Петербург_аэропорт" to "41000000000",
    "Свердлова" to "41000000000",
    "Сестрорецк" to "41000000000",
    "Смолячково" to "41000000000",
    "Солнечное" to "41000000000",
    "Старая" to "41000000000",
    "Тайцы" to "41000000000",
    "Усть-Ижора" to "41000000000",
    "Шушары" to "41000000000",
    "Янино" to "41000000000",
    "Колтуши" to "41000000000",
    "Парголово" to "41000000000",
    "Песочный" to "41000000000",
    "Репино" to "41000000000",

    // Сельские поселения (151-200)
    "Ямское_Тверская" to "28628412101",
    "Завидовское_Тверская" to "28628412102",
    "Козловское_Тверская" to "28628412103",
    "Белое_Озеро_Вологодская" to "41618402101",
    "Горское_Московская" to "46608102001",
    "Дмитровское_Московская" to "46608102002",
    "Ермолинское_Московская" to "46608102003",
    "Железнодорожное_Московская" to "46608102004",
    "Зарайское_Московская" to "46616102001",
    "Истринское_Московская" to "46633102001",
    "Клинское_Московская" to "46637102001",
    "Коломенское_Московская" to "46638102001",
    "Красногорское_Московская" to "46639102001",
    "Ленинское_Московская" to "46641102001",
    "Лотошинское_Московская" to "46642102001",
    "Луховицкое_Московская" to "46630102001",
    "Люберецкое_Московская" to "46648102001",
    "Можайское_Московская" to "46633102002",
    "Мытищинское_Московская" to "46646102001",
    "Наро-Фоминское_Московская" to "46638102002",
    "Ногинское_Московская" to "46651102001",
    "Одинцовское_Московская" to "46655102001",
    "Озерское_Московская" to "46656102001",
    "Павлово-Посадское" to "46646102002",
    "Подольское_Московская" to "46646102003",
    "Пушкинское_Московская" to "46658102001",
    "Раменское_Московская" to "46646102004",
    "Рузское_Московская" to "46646102005",
    "Сергиево-Посадское" to "46628102001",
    "Серебряно-Прудское" to "46646102006",
    "Серпуховское_Московская" to "46670102001",
    "Солнечногорское" to "46652102001",
    "Ступинское_Московская" to "46646102007",
    "Талдомское_Московская" to "46646102008",
    "Чеховское_Московская" to "46657102001",
    "Шатурское_Московская" to "46657102002",
    "Щелковское_Московская" to "46659102001",
    "Электростальское" to "46640102001",
    "Яхромское_Московская" to "46615102001",
    "Звенигородское_Московская" to "46633102003",
    "Икшинское_Московская" to "46615102002",
    "Каринское_Московская" to "46646102009",
    "Костинское_Московская" to "46637102002",
    "Краснополянское" to "46659102002",
    "Лесное_Московская" to "46646102010",
    "Марфинское_Московская" to "46646102011",
    "Некрасовское_Московская" to "46646102012",
    "Опалиховское" to "46646102013",
    "Поваровское_Московская" to "46652102002",
    "Развилковское" to "46610000001",
    "Ржавское_Московская" to "46646102014",
    "Саврасовское" to "46646102015",
    "Сельцо_Брянская" to "15653412101",
    "Деревня_Новая_Тверь" to "28628412104",
    "Село_Старое_Вологда" to "41618402102",
    "Поселок_Светлый_Москва" to "46608102005",
    "Хутор_Вольный_Кубань" to "03618402101"
  )

  /**
   * Поиск ОКТМО по названию города или случайный выбор.
   *
   * @param cityName Название города (регистр не важен). Если null, выбирается случайный город.
   * @param fullCode Если true, возвращает 11-значный код; если false — 8-значный; если null — случайный выбор (50/50).
   * @return Код ОКТМО или null, если город не найден (или база пуста).
   */
  private fun findOKTMO(@Suppress("SameParameterValue") cityName: String? = null, fullCode: Boolean? = null): String? {
    return when {
      // Если город указан, ищем его в базе
      cityName != null -> {
        when (fullCode) {
          true -> 11
          false -> 8
          null -> if (Random.nextBoolean()) 11 else 8
        }.let { chooseByLength(it) }
          .entries
          .find { it.key.equals(cityName, ignoreCase = true) }
          ?.value
      }

      else -> {
        when (fullCode) {
          true -> 11
          false -> 8
          null -> if (Random.nextBoolean()) 11 else 8
        }.let { chooseByLength(it) }.values.random()
      }
    }
  }

  private fun chooseByLength(targetLength: Int): Map<String, String> {
    return when (targetLength) {
      11 -> OKTMO_11_DATABASE
      8 -> OKTMO_8_DATABASE
      else -> throw IllegalArgumentException("Invalid length $targetLength")
    }
  }
}
